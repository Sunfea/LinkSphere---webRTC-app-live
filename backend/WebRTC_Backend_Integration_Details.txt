WebRTC Backend Integration Details for Frontend Development

1. Signaling Server Details:

   WebSocket Endpoint URL:
   - ws://localhost:8000/ws/signaling/{room_id}
   - Example: ws://localhost:8000/ws/signaling/room123

   Authentication:
   - Requires JWT token for connection
   - Token must be provided in the Authorization header as a Bearer token
   - Token is obtained through the authentication flow (register -> verify OTP -> set username -> login)

   Message Format:
   All messages are JSON objects with a "type" field indicating the message type.

   Offer Message:
   {
     "type": "offer",
     "sender": "username",
     "target": "target_username",
     "sdp": "RTCSessionDescription SDP content"
   }

   Answer Message:
   {
     "type": "answer",
     "sender": "username",
     "target": "target_username",
     "sdp": "RTCSessionDescription SDP content"
   }

   ICE Candidate Message:
   {
     "type": "candidate",
     "sender": "username",
     "target": "target_username",
     "candidate": "RTCIceCandidate content"
   }

   User Joined Notification:
   {
     "type": "user_joined",
     "username": "new_user",
     "room_id": "room123"
   }

   User Left Notification:
   {
     "type": "user_left",
     "username": "departing_user",
     "room_id": "room123"
   }

   Heartbeat:
   {
     "type": "heartbeat"
   }

   Heartbeat Response:
   {
     "type": "heartbeat_response"
   }

2. API Endpoints:

   Base URL: http://localhost:8000/api

   Authentication Endpoints:
   - POST /auth/signup
     Request: {"email": "user@example.com"}
     Response: {"message": "OTP sent to your email"}
     Authentication: None

   - POST /auth/verify-otp
     Request: {"email": "user@example.com", "otp": "123456"}
     Response: {"message": "OTP verified successfully"}
     Authentication: None

   - POST /auth/set-username
     Request: {"email": "user@example.com", "username": "uniqueusername"}
     Response: {"message": "Username set successfully"}
     Authentication: None

   - POST /auth/login
     Request: {"email": "user@example.com"}
     Response: {"access_token": "JWT_TOKEN", "token_type": "bearer"}
     Authentication: None

   Room Management Endpoints:
   - POST /rooms/
     Request: {"name": "Room Name", "description": "Room Description"}
     Response: Room details with participants list
     Authentication: Required (JWT Bearer token)

   - GET /rooms/
     Request: None
     Response: List of rooms the user is part of
     Authentication: Required (JWT Bearer token)

   - GET /rooms/{room_id}
     Request: None
     Response: Details of a specific room
     Authentication: Required (JWT Bearer token)

   - POST /rooms/{room_id}/join
     Request: None
     Response: Updated room details
     Authentication: Required (JWT Bearer token)

   - POST /rooms/{room_id}/leave
     Request: None
     Response: Updated room details
     Authentication: Required (JWT Bearer token)

3. WebRTC Flow:

   Room/Session Creation and Management:
   - Rooms are created via POST /rooms/ endpoint
   - Each room has a unique room_id generated by the backend
   - Users join rooms via POST /rooms/{room_id}/join
   - Users leave rooms via POST /rooms/{room_id}/leave
   - Room participants are tracked in the database

   Peer Discovery:
   - When a user joins a room, a "user_joined" message is broadcast to all other participants
   - When a user leaves a room, a "user_left" message is broadcast to all other participants
   - The signaling server maintains a list of connected users per room

   STUN/TURN Configuration:
   - The backend does not provide STUN/TURN server configurations
   - You'll need to configure your own STUN servers or use public ones like:
     stun:stun.l.google.com:19302
     stun:stun1.l.google.com:19302

4. Message Protocol:

   Incoming Messages (from clients to backend):
   - Offer: WebRTC SDP offer for establishing connection
   - Answer: WebRTC SDP answer in response to an offer
   - Candidate: ICE candidate for NAT traversal
   - Heartbeat: Keep-alive message

   Outgoing Messages (from backend to clients):
   - Offer: Forwarded SDP offer from another peer
   - Answer: Forwarded SDP answer from another peer
   - Candidate: Forwarded ICE candidate from another peer
   - User Joined: Notification when a new user joins the room
   - User Left: Notification when a user leaves the room
   - Heartbeat Response: Response to client heartbeat

   Custom Events:
   - No additional custom events beyond the standard WebRTC signaling messages

5. Features Implemented:

   Core Features:
   - Video and audio communication
   - Real-time text chat (via data channels)
   - Room-based session management
   - User authentication with JWT tokens
   - Email verification with OTP during registration

   Limitations:
   - No built-in screen sharing (would need to be implemented in frontend)
   - No server-side recording
   - No file transfer (could be implemented via data channels)
   - No specific room size limits (constrained by server resources)
   - No participant restrictions beyond authentication

   Data Channel Support:
   - Supported for custom messaging
   - Not currently used for chat in the backend (handled via WebSocket signaling)
   - Can be implemented in frontend for peer-to-peer chat

6. Configuration:

   Backend Base URL and Port:
   - URL: http://localhost:8000
   - WebSocket URL: ws://localhost:8000/ws/signaling/{room_id}
   - API endpoints under /api prefix

   CORS Settings:
   - CORS is enabled for all origins in development
   - In production, you should specify exact origins
   - Headers, methods, and credentials are all allowed

   Environment Variables:
   - SECRET_KEY: JWT secret key (default: "your-secret-key-here")
   - ALGORITHM: JWT algorithm (default: "HS256")
   - ACCESS_TOKEN_EXPIRE_MINUTES: JWT token expiration (default: 30)
   - DATABASE_URL: Database connection string (default: "sqlite:///./test.db")
   - REDIS_URL: Redis connection string (default: "redis://localhost:6379")
   - SMTP_SERVER: Email server (default: "localhost")
   - SMTP_PORT: Email server port (default: 1025)
   - EMAIL_USER: Email user (default: "test@example.com")
   - EMAIL_PASSWORD: Email password (default: "password")

   Additional Notes:
   - In development, emails (OTP and username) are printed to the console instead of being sent
   - SQLite is used as the default database
   - Redis is optional; if unavailable, the system falls back to in-memory storage
   - All API endpoints return JSON responses
   - Error responses follow the format: {"detail": "Error message"}